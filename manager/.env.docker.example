# =============================================================================
# Flint Manager — Docker Environment Template
# =============================================================================
# Copy this file to .env before starting the Docker stack:
#
#   cp .env.docker.example .env
#
# Then fill in the values marked as required below.
# WARNING: Never commit .env to version control — it contains secrets.
# =============================================================================


## ---------------------------------------------------------------------------
## Manager Auth
## ---------------------------------------------------------------------------

# Shared secret used to authenticate with the Flint Manager UI.
# Anyone who holds this key has full access to the manager and all registered
# sites. Generate a strong random value with:
#
#   openssl rand -hex 32
#
# The manager will auto-generate a key on first boot if this is unset and
# save it back to .env — but for Docker you should set it explicitly so the
# key survives container rebuilds and image upgrades.
MANAGER_API_KEY=

# The port the Bun HTTP server listens on inside the container.
# Traefik proxies external traffic to this port. You should not need to change
# this unless you have a port conflict with another service inside the same
# container network.
MANAGER_PORT=8080

# Optional absolute path inside the container to write structured NDJSON
# request logs (one JSON object per line, daily rotation).
# Leave empty to send all logs to stdout only — this is the recommended
# approach in Docker because the container runtime (e.g. Docker, Compose,
# cloud log drivers) will capture and forward stdout automatically.
MANAGER_LOG_DIR=


## ---------------------------------------------------------------------------
## ngrok Tunnel  (only required when using: docker compose --profile tunnel up)
## ---------------------------------------------------------------------------

# Your personal ngrok authentication token.
# Find it at: https://dashboard.ngrok.com/get-started/your-authtoken
#
# This is required when running the ngrok service (--profile tunnel).
# Without a valid token the ngrok container will fail to start and exit
# immediately with an authentication error.
NGROK_AUTHTOKEN=

# (Optional) A reserved ngrok static domain so you always receive the same
# public URL across restarts. Leave empty to receive a randomly-assigned URL
# that changes every time ngrok reconnects.
#
# Reserve a free static domain at:
#   ngrok Dashboard → Cloud Edge → Domains → + New Domain
#
# Example:  mymanager.ngrok.app
#
# If you set a static domain here, also update MANAGER_HOST below to match,
# so Traefik's router rule accepts requests on that hostname.
NGROK_DOMAIN=


## ---------------------------------------------------------------------------
## Traefik Routing
## ---------------------------------------------------------------------------

# The hostname used in the Traefik router rule: Host(`<MANAGER_HOST>`)
# Traefik only forwards requests whose Host header matches this value.
#
# Choose the value that matches your setup:
#
#   Local dev (no tunnel):
#     Leave as `localhost` → access the manager at http://localhost
#
#   ngrok tunnel with a random URL:
#     Leave as `localhost` for the initial start. After running:
#       docker compose --profile tunnel up -d
#     retrieve the assigned public URL with:
#       curl http://localhost:4040/api/endpoints | jq -r '.endpoints[0].url'
#     The manager will be reachable at that URL. (ngrok rewrites the Host
#     header in HTTP mode so MANAGER_HOST does not need to match the ngrok
#     subdomain in this case.)
#
#   ngrok tunnel with a reserved static domain:
#     Set this to your static domain, e.g. mymanager.ngrok.app
#     Make sure it matches NGROK_DOMAIN above.
MANAGER_HOST=localhost


# =============================================================================
# Quick-start
# =============================================================================
#
# 1. Copy and edit this file:
#      cp .env.docker.example .env
#
# 2. Generate an API key and paste it into MANAGER_API_KEY:
#      openssl rand -hex 32
#
# 3. Start the core stack (local access only):
#      docker compose up -d
#
# 4. Start with a public ngrok tunnel:
#      docker compose --profile tunnel up -d
#
# 5. Get the public tunnel URL (random-URL mode):
#      curl http://localhost:4040/api/endpoints | jq -r '.endpoints[0].url'
#
# =============================================================================
# Notes
# =============================================================================
#
# manager.config.yaml — site paths must be absolute container paths
#   When running in Docker, the `path:` field for each registered site in
#   manager.config.yaml must be an absolute path inside the container, not a
#   path on the host. For example:
#
#     sites:
#       - id: main
#         path: /sites/main        ✓ correct (container path)
#         # path: ../my-site       ✗ wrong   (relative / host path)
#
# Site volumes — bind-mount and install dependencies
#   Each Flint site managed by this instance must be:
#     a) Bind-mounted into the container at the path listed in
#        manager.config.yaml (e.g. /sites/main).
#     b) Have `bun install` run inside the mounted directory so that
#        node_modules is present. The manager spawns subprocesses such as
#        `bun run build`, `bunx rspack`, and `bun run build:sync` directly
#        inside each site directory — those commands will fail if
#        node_modules is missing.
#
#   Example docker-compose volume entry:
#     volumes:
#       - /host/path/to/my-flint-site:/sites/main
#
# =============================================================================
